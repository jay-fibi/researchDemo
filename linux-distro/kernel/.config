#
# Linux Kernel Configuration for Cloud-Optimized Distribution
# Optimized for AWS, Azure, and GCP environments
#

# Basic configuration
CONFIG_64BIT=y
CONFIG_X86_64=y

# Cloud provider optimizations
# AWS optimizations
CONFIG_XEN=y
CONFIG_XEN_PV=y
CONFIG_XEN_PVHVM=y
CONFIG_XEN_DOM0=y
CONFIG_XEN_PRIVILEGED_GUEST=y
CONFIG_PARAVIRT=y
CONFIG_PARAVIRT_CLOCK=y
CONFIG_KVM_GUEST=y
CONFIG_VIRTIO=y
CONFIG_VIRTIO_PCI=y
CONFIG_VIRTIO_BLK=y
CONFIG_VIRTIO_NET=y
CONFIG_VIRTIO_CONSOLE=y
CONFIG_VIRTIO_BALLOON=y
CONFIG_VIRTIO_INPUT=y
CONFIG_VIRTIO_MMIO=y

# Azure optimizations
CONFIG_HYPERV=y
CONFIG_HYPERV_UTILS=y
CONFIG_HYPERV_BALLOON=y
CONFIG_HYPERV_KEYBOARD=y
CONFIG_HYPERV_STORAGE=y
CONFIG_HYPERV_NET=y
CONFIG_HYPERV_VSOCKETS=y
CONFIG_PCI_HYPERV=y
CONFIG_HYPERV_IOMMU=y

# GCP optimizations
CONFIG_GCP=y
CONFIG_GCP_BALLOON=y
CONFIG_GCP_CLOCKSOURCE=y
CONFIG_GCP_CONSOLE=y
CONFIG_GCP_NETWORK=y
CONFIG_GCP_STORAGE=y

# Networking optimizations for cloud
CONFIG_NET=y
CONFIG_INET=y
CONFIG_IPV6=y
CONFIG_NETFILTER=y
CONFIG_NETFILTER_ADVANCED=y
CONFIG_BRIDGE=y
CONFIG_VLAN_8021Q=y
CONFIG_IP_NF_TARGET_MASQUERADE=y
CONFIG_NET_SCHED=y
CONFIG_NET_SCH_HTB=y
CONFIG_NET_SCH_SFQ=y

# Storage optimizations
CONFIG_BLK_DEV=y
CONFIG_BLK_DEV_SD=y
CONFIG_BLK_DEV_NVME=y
CONFIG_NVME_CORE=y
CONFIG_NVME_HWMON=y
CONFIG_SCSI=y
CONFIG_SCSI_LOWLEVEL=y
CONFIG_SCSI_VIRTIO=y
CONFIG_ATA=y
CONFIG_ATA_SFF=y
CONFIG_SATA_AHCI=y

# Memory management
CONFIG_MEMORY_HOTPLUG=y
CONFIG_MEMORY_HOTREMOVE=y
CONFIG_BALLOON_COMPACTION=y
CONFIG_COMPACTION=y
CONFIG_KSM=y
CONFIG_TRANSPARENT_HUGEPAGE=y
CONFIG_TRANSPARENT_HUGEPAGE_ALWAYS=y

# CPU optimizations
CONFIG_SCHED_AUTOGROUP=y
CONFIG_SCHED_FAIR=y
CONFIG_SCHED_HRTICK=y
CONFIG_CPU_FREQ=y
CONFIG_CPU_FREQ_DEFAULT_GOV_ONDEMAND=y
CONFIG_CPU_FREQ_GOV_ONDEMAND=y
CONFIG_CPU_FREQ_GOV_CONSERVATIVE=y
CONFIG_CPU_FREQ_GOV_PERFORMANCE=y

# Security features
CONFIG_SECURITY=y
CONFIG_SECURITY_SELINUX=y
CONFIG_SECURITY_SELINUX_BOOTPARAM=y
CONFIG_SECURITY_SELINUX_DISABLE=y
CONFIG_SECURITY_SELINUX_DEVELOP=y
CONFIG_SECURITY_SELINUX_AVC_STATS=y
CONFIG_SECURITY_SELINUX_CHECKREQPROT_VALUE=1
CONFIG_SECURITY_APPARMOR=y
CONFIG_SECURITY_APPARMOR_HASH=y
CONFIG_SECURITY_APPARMOR_HASH_DEFAULT=y

# Cloud monitoring and logging
CONFIG_SYSFS=y
CONFIG_PROC_FS=y
CONFIG_PROC_SYSCTL=y
CONFIG_PROC_PAGE_MONITOR=y
CONFIG_PROC_CHILDREN=y
CONFIG_KALLSYMS=y
CONFIG_KALLSYMS_ALL=y

# Essential drivers
CONFIG_EXT4_FS=y
CONFIG_EXT4_USE_FOR_EXT2=y
CONFIG_XFS_FS=y
CONFIG_BTRFS_FS=y
CONFIG_OVERLAY_FS=y
CONFIG_TMPFS=y
CONFIG_TMPFS_POSIX_ACL=y
CONFIG_TMPFS_XATTR=y

# Network filesystems for cloud storage
CONFIG_NFS_FS=y
CONFIG_NFS_V4=y
CONFIG_NFS_V4_1=y
CONFIG_NFS_V4_2=y
CONFIG_CIFS=y
CONFIG_CIFS_STATS=y
CONFIG_CIFS_XATTR=y

# Compression
CONFIG_ZLIB_INFLATE=y
CONFIG_ZLIB_DEFLATE=y
CONFIG_LZO_COMPRESS=y
CONFIG_LZO_DECOMPRESS=y
CONFIG_LZ4_COMPRESS=y
CONFIG_LZ4_DECOMPRESS=y
CONFIG_ZSTD_COMPRESS=y
CONFIG_ZSTD_DECOMPRESS=y

# Minimal system
CONFIG_EMBEDDED=y
CONFIG_EXPERT=y
CONFIG_MODULES=y
CONFIG_MODULE_UNLOAD=y
CONFIG_MODVERSIONS=y
CONFIG_MODULE_SRCVERSION_ALL=y

# Disable unnecessary features for minimal footprint
# CONFIG_SOUND is not set
# CONFIG_VIDEO_DEV is not set
# CONFIG_USB is not set
# CONFIG_WIRELESS is not set
# CONFIG_BT is not set
# CONFIG_HID is not set
# CONFIG_INPUT_MOUSE is not set
# CONFIG_INPUT_JOYSTICK is not set
# CONFIG_INPUT_TABLET is not set
# CONFIG_INPUT_TOUCHSCREEN is not set

# Enable cloud-init support
CONFIG_CLOUD_INIT=y
CONFIG_CLOUD_INIT_DEF_CONFIG_FILE="/etc/cloud/cloud.cfg"
CONFIG_CLOUD_INIT_LOG_FILE="/var/log/cloud-init.log"
CONFIG_CLOUD_INIT_RUNCMD=y
CONFIG_CLOUD_INIT_BOOTCMD=y
CONFIG_CLOUD_INIT_USER_DATA=y
CONFIG_CLOUD_INIT_VENDOR_DATA=y

# AWS specific
CONFIG_AWS_EC2=y
CONFIG_AWS_EBS=y
CONFIG_AWS_S3=y
CONFIG_AWS_CLOUDWATCH=y
CONFIG_AWS_SYSTEMS_MANAGER=y

# Azure specific
CONFIG_AZURE_VM=y
CONFIG_AZURE_STORAGE=y
CONFIG_AZURE_NETWORK=y
CONFIG_AZURE_MONITOR=y

# GCP specific
CONFIG_GCP_COMPUTE=y
CONFIG_GCP_STORAGE=y
CONFIG_GCP_NETWORK=y
CONFIG_GCP_LOGGING=y
CONFIG_GCP_MONITORING=y
